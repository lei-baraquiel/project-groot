<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Flood Response & Dispatch System</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- FontAwesome for Icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <style>
      /* Custom Animations */
      .pulse-ring {
        box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7);
        animation: pulse-red 2s infinite;
      }
      @keyframes pulse-red {
        0% {
          transform: scale(0.95);
          box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7);
        }
        70% {
          transform: scale(1);
          box-shadow: 0 0 0 10px rgba(239, 68, 68, 0);
        }
        100% {
          transform: scale(0.95);
          box-shadow: 0 0 0 0 rgba(239, 68, 68, 0);
        }
      }
      .map-placeholder {
        background-image: url("https://upload.wikimedia.org/wikipedia/commons/e/ec/World_map_blank_without_borders.svg");
        background-size: cover;
        background-position: center;
      }
      /* Tab Transitions */
      .tab-content {
        transition: all 0.3s ease;
      }
    </style>
  </head>
  <body class="bg-gray-100 font-sans text-gray-800">
    <!-- APP CONTAINER -->
    <div
      id="app"
      class="max-w-md mx-auto min-h-screen bg-white shadow-2xl relative overflow-hidden"
    >
      <!-- HEADER -->
      <header
        class="bg-slate-900 text-white p-4 flex justify-between items-center sticky top-0 z-50"
      >
        <div class="flex items-center gap-2">
          <i class="fa-solid fa-house-flood-water text-blue-400 text-xl"></i>
          <h1 class="font-bold tracking-wide">
            FLOOD<span class="text-blue-400">GUARD</span>
          </h1>
        </div>
        <!-- Role Switcher for Demo Purposes -->
        <button
          onclick="toggleRole()"
          class="text-xs bg-slate-700 hover:bg-slate-600 px-3 py-1 rounded border border-slate-500"
        >
          <i class="fa-solid fa-users-viewfinder mr-1"></i>
          <span id="role-label">Switch to Admin</span>
        </button>
      </header>

      <!-- ======================= -->
      <!-- VIEW: PUBLIC USER (VICTIM) -->
      <!-- ======================= -->
      <div id="view-user" class="p-0">
        <!-- Hero / Panic Button -->
        <div
          id="user-home"
          class="flex flex-col items-center justify-center h-[80vh] bg-gradient-to-b from-slate-50 to-red-50 relative"
        >
          <div class="absolute inset-0 opacity-10 map-placeholder"></div>

          <h2 class="text-2xl font-bold mb-8 text-center px-6 relative z-10">
            Is there a flood emergency?
          </h2>

          <button
            onclick="startReport()"
            class="w-64 h-64 rounded-full bg-red-600 text-white text-3xl font-bold shadow-2xl pulse-ring flex flex-col items-center justify-center transition hover:bg-red-700 relative z-10 border-4 border-red-400"
          >
            <i class="fa-solid fa-triangle-exclamation mb-2 text-4xl"></i>
            REPORT
            <span class="text-sm font-normal mt-1 opacity-80"
              >Tap for Help</span
            >
          </button>

          <p
            class="mt-8 text-gray-500 text-sm max-w-xs text-center relative z-10"
          >
            <i class="fa-solid fa-location-dot mr-1"></i> GPS Tracking Enabled
          </p>
        </div>

        <!-- Report Form -->
        <div id="user-form" class="hidden min-h-screen bg-white p-6 pb-20">
          <h2 class="text-xl font-bold mb-4">Report Details</h2>

          <!-- Location Status -->
          <div
            class="bg-blue-50 border border-blue-200 rounded-lg p-3 mb-6 flex items-center gap-3"
          >
            <div
              class="bg-blue-500 text-white w-10 h-10 rounded-full flex items-center justify-center shrink-0"
            >
              <i class="fa-solid fa-location-crosshairs animate-spin-slow"></i>
            </div>
            <div>
              <p class="text-xs text-blue-600 font-bold uppercase">
                Location Acquired
              </p>
              <p class="text-sm font-mono text-gray-700" id="gps-coords">
                Fetching...
              </p>
              <p class="text-xs text-gray-500" id="gps-accuracy">
                Accuracy: Calculating...
              </p>
            </div>
          </div>

          <!-- Form Inputs -->
          <div class="space-y-6">
            <div>
              <label class="block text-sm font-bold text-gray-700 mb-1"
                >Water Level</label
              >
              <div class="grid grid-cols-3 gap-2">
                <button
                  onclick="selectSeverity('low')"
                  class="severity-btn p-3 border rounded-lg text-center hover:bg-yellow-50 focus:ring-2 ring-yellow-400 transition"
                  data-val="low"
                >
                  <div class="h-2 w-full bg-yellow-400 mb-2 rounded"></div>
                  <span class="text-sm">Ankle</span>
                </button>
                <button
                  onclick="selectSeverity('med')"
                  class="severity-btn p-3 border rounded-lg text-center hover:bg-orange-50 focus:ring-2 ring-orange-400 transition"
                  data-val="med"
                >
                  <div class="h-4 w-full bg-orange-500 mb-2 rounded"></div>
                  <span class="text-sm">Waist</span>
                </button>
                <button
                  onclick="selectSeverity('high')"
                  class="severity-btn p-3 border rounded-lg text-center hover:bg-red-50 focus:ring-2 ring-red-400 transition"
                  data-val="high"
                >
                  <div class="h-8 w-full bg-red-600 mb-2 rounded"></div>
                  <span class="text-sm">Head/Roof</span>
                </button>
              </div>
            </div>

            <!-- VERIFICATION SELECTION -->
            <div>
              <label class="block text-sm font-bold text-gray-700 mb-2"
                >Verification Method</label
              >

              <!-- Tabs -->
              <div class="flex rounded-md shadow-sm mb-4" role="group">
                <button
                  onclick="setVerificationMode('photo')"
                  id="tab-photo"
                  class="flex-1 px-4 py-2 text-sm font-medium text-gray-900 bg-white border border-gray-200 rounded-l-lg hover:bg-gray-100 hover:text-blue-700 focus:z-10 focus:ring-2 focus:ring-blue-700 focus:text-blue-700 bg-gray-100 text-blue-700 ring-2 ring-blue-700"
                >
                  <i class="fa-solid fa-camera mr-1"></i> Photo
                </button>
                <button
                  onclick="setVerificationMode('sensor')"
                  id="tab-sensor"
                  class="flex-1 px-4 py-2 text-sm font-medium text-gray-900 bg-white border-t border-b border-gray-200 hover:bg-gray-100 hover:text-blue-700 focus:z-10 focus:ring-2 focus:ring-blue-700 focus:text-blue-700"
                >
                  <i class="fa-solid fa-mobile-screen-button mr-1"></i> Sensor
                </button>
                <button
                  onclick="setVerificationMode('sms')"
                  id="tab-sms"
                  class="flex-1 px-4 py-2 text-sm font-medium text-gray-900 bg-white border border-gray-200 rounded-r-lg hover:bg-gray-100 hover:text-blue-700 focus:z-10 focus:ring-2 focus:ring-blue-700 focus:text-blue-700"
                >
                  <i class="fa-solid fa-comment-sms mr-1"></i> SMS
                </button>
              </div>

              <!-- CONTENT: PHOTO -->
              <div id="content-photo" class="tab-content block">
                <div
                  class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:bg-gray-50 cursor-pointer transition"
                  onclick="document.getElementById('file-input').click()"
                >
                  <i class="fa-solid fa-camera text-gray-400 text-2xl mb-2"></i>
                  <p class="text-sm text-gray-500">Tap to take proof photo</p>
                  <input
                    type="file"
                    id="file-input"
                    class="hidden"
                    accept="image/*"
                    onchange="handleFile(this)"
                  />
                </div>
                <p id="file-name" class="text-xs text-green-600 mt-1 hidden">
                  <i class="fa-solid fa-check"></i> Photo attached
                </p>
              </div>

              <!-- CONTENT: SENSOR (Quick) -->
              <div id="content-sensor" class="tab-content hidden">
                <div class="bg-slate-50 border border-slate-200 rounded-lg p-4">
                  <p class="text-xs text-gray-500 mb-3">
                    Uses device accelerometer to verify presence and detect
                    environmental instability without using data.
                  </p>
                  <button
                    onclick="runSensorCheck()"
                    id="sensor-btn"
                    class="w-full py-3 bg-white border border-slate-300 rounded shadow-sm text-slate-700 text-sm font-bold flex items-center justify-center gap-2"
                  >
                    <i class="fa-solid fa-fingerprint"></i> Run Sensor Check
                  </button>
                  <p
                    id="sensor-result"
                    class="text-xs text-green-600 mt-2 font-bold hidden text-center"
                  >
                    <i class="fa-solid fa-check-circle"></i> Biometrics & Motion
                    Verified
                  </p>
                </div>
              </div>

              <!-- CONTENT: SMS (Low Bandwidth) -->
              <div id="content-sms" class="tab-content hidden">
                <div class="bg-slate-50 border border-slate-200 rounded-lg p-4">
                  <p class="text-xs text-gray-500 mb-3">
                    For low signal areas. We will prioritize text-based
                    communication.
                  </p>
                  <input
                    type="tel"
                    placeholder="Your Phone Number"
                    class="w-full p-2 border rounded mb-2 text-sm"
                  />
                  <div class="flex items-center gap-2">
                    <input
                      type="checkbox"
                      id="sms-check"
                      class="rounded text-blue-600"
                      checked
                    />
                    <label for="sms-check" class="text-xs text-gray-600"
                      >Request callback from rescue team</label
                    >
                  </div>
                </div>
              </div>
            </div>

            <div>
              <label class="block text-sm font-bold text-gray-700 mb-1"
                >Number of People</label
              >
              <select
                id="people-count"
                class="w-full p-3 border rounded-lg bg-white"
              >
                <option value="1">1 Person</option>
                <option value="2-4">2-4 People</option>
                <option value="5+">5+ People</option>
              </select>
            </div>
          </div>

          <button
            onclick="submitReport()"
            class="w-full mt-8 bg-slate-900 text-white py-4 rounded-lg font-bold text-lg shadow-lg hover:bg-slate-800 transition transform active:scale-95"
          >
            SEND REQUEST
          </button>
          <button
            onclick="cancelReport()"
            class="w-full mt-3 text-gray-500 py-2 text-sm"
          >
            Cancel
          </button>
        </div>

        <!-- Status Screen (After Submission) -->
        <div
          id="user-status"
          class="hidden h-screen bg-white p-6 flex flex-col items-center pt-20"
        >
          <div
            id="status-icon-container"
            class="w-24 h-24 rounded-full bg-yellow-100 flex items-center justify-center mb-6"
          >
            <i
              id="status-icon"
              class="fa-solid fa-satellite-dish text-yellow-600 text-4xl animate-pulse"
            ></i>
          </div>

          <h2 id="status-title" class="text-2xl font-bold text-slate-900">
            Request Received
          </h2>
          <p id="status-desc" class="text-center text-gray-600 mt-2 mb-8">
            Your location has been logged. We are assessing severity.
          </p>

          <!-- Status Timeline -->
          <div class="w-full max-w-xs space-y-6 relative">
            <div class="absolute left-3 top-2 bottom-2 w-0.5 bg-gray-200"></div>

            <div class="flex items-start gap-4 relative">
              <div
                class="w-6 h-6 rounded-full bg-green-500 border-2 border-white shadow flex items-center justify-center z-10"
              >
                <i class="fa-solid fa-check text-white text-[10px]"></i>
              </div>
              <div>
                <p class="text-sm font-bold">Report Sent</p>
                <p class="text-xs text-gray-500">10:42 AM</p>
              </div>
            </div>

            <div
              class="flex items-start gap-4 relative opacity-40 transition-opacity duration-500"
              id="step-verified"
            >
              <div
                class="w-6 h-6 rounded-full bg-gray-300 border-2 border-white shadow z-10"
              ></div>
              <div>
                <p class="text-sm font-bold">Verified</p>
                <p class="text-xs text-gray-500">Validation in progress...</p>
              </div>
            </div>

            <div
              class="flex items-start gap-4 relative opacity-40 transition-opacity duration-500"
              id="step-dispatched"
            >
              <div
                class="w-6 h-6 rounded-full bg-gray-300 border-2 border-white shadow z-10"
              ></div>
              <div>
                <p class="text-sm font-bold">Rescuers Dispatched</p>
                <p class="text-xs text-gray-500">Team is on the way</p>
              </div>
            </div>
          </div>

          <div
            id="arrival-msg"
            class="hidden mt-8 bg-green-50 border border-green-200 p-4 rounded-lg text-center w-full animate-bounce"
          >
            <p class="text-green-800 font-bold">
              <i class="fa-solid fa-truck-medical mr-2"></i> TEAM EN ROUTE
            </p>
            <p class="text-green-700 text-sm">ETA: 12 Minutes</p>
          </div>
        </div>
      </div>

      <!-- ======================= -->
      <!-- VIEW: COMMAND CENTER (ADMIN) -->
      <!-- ======================= -->
      <div id="view-admin" class="hidden bg-gray-100 min-h-screen pb-20">
        <div class="bg-white p-4 shadow-sm border-b">
          <div class="flex justify-between items-end">
            <div>
              <h2 class="font-bold text-slate-800">Situation Dashboard</h2>
              <p class="text-xs text-gray-500">Live Reports Feed</p>
            </div>
            <div class="flex gap-2 text-xs">
              <span class="px-2 py-1 bg-red-100 text-red-700 rounded font-bold"
                >3 CRITICAL</span
              >
              <span
                class="px-2 py-1 bg-yellow-100 text-yellow-700 rounded font-bold"
                >5 ACTIVE</span
              >
            </div>
          </div>
        </div>

        <!-- Map Visualization (Static for Demo) -->
        <div
          class="h-48 w-full map-placeholder relative border-b border-gray-300"
        >
          <div
            class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2"
          >
            <span class="relative flex h-3 w-3">
              <span
                class="animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"
              ></span>
              <span
                class="relative inline-flex rounded-full h-3 w-3 bg-red-500"
              ></span>
            </span>
          </div>
          <div class="absolute top-1/3 left-1/3">
            <div class="w-2 h-2 bg-orange-500 rounded-full"></div>
          </div>
          <div
            class="absolute bottom-10 right-10 bg-white/90 px-2 py-1 text-[10px] rounded shadow backdrop-blur-sm"
          >
            Live Cluster View
          </div>
        </div>

        <!-- Report List -->
        <div class="p-4 space-y-4" id="admin-feed">
          <!-- Javascript will inject reports here -->
          <p class="text-center text-gray-400 text-sm mt-10">
            Waiting for reports...
          </p>
        </div>
      </div>
    </div>

    <!-- JAVASCRIPT LOGIC -->
    <script>
      // --- STATE MANAGEMENT ---
      let appState = {
        currentView: "user",
        reports: [],
        currentUserLat: null,
        currentUserLng: null,
        currentUserAccuracy: null,
      };

      let selectedSeverityLevel = "";
      let currentVerificationMode = "photo"; // Default
      let sensorVerified = false;

      // --- VIEW CONTROLLER ---
      function toggleRole() {
        const btn = document.getElementById("role-label");
        if (appState.currentView === "user") {
          appState.currentView = "admin";
          document.getElementById("view-user").classList.add("hidden");
          document.getElementById("view-admin").classList.remove("hidden");
          btn.innerText = "Switch to User";
          renderAdminFeed();
        } else {
          appState.currentView = "user";
          document.getElementById("view-admin").classList.add("hidden");
          document.getElementById("view-user").classList.remove("hidden");
          btn.innerText = "Switch to Admin";
        }
      }

      // --- USER FLOW ---

      function startReport() {
        document.getElementById("user-home").classList.add("hidden");
        document.getElementById("user-form").classList.remove("hidden");

        // 1. AUTOMATIC LOCATION TRACKING
        if ("geolocation" in navigator) {
          navigator.geolocation.getCurrentPosition(
            (position) => {
              appState.currentUserLat = position.coords.latitude;
              appState.currentUserLng = position.coords.longitude;
              appState.currentUserAccuracy = position.coords.accuracy;

              document.getElementById(
                "gps-coords"
              ).innerText = `${position.coords.latitude.toFixed(
                4
              )}, ${position.coords.longitude.toFixed(4)}`;

              const accColor =
                position.coords.accuracy < 20
                  ? "text-green-600"
                  : "text-yellow-600";
              document.getElementById(
                "gps-accuracy"
              ).innerHTML = `Accuracy: <span class="${accColor} font-bold">Within ${Math.round(
                position.coords.accuracy
              )}m</span>`;
            },
            (error) => {
              document.getElementById("gps-coords").innerText =
                "Location Denied";
              document.getElementById("gps-accuracy").innerText =
                "Please enable GPS";
            }
          );
        } else {
          alert("Geolocation is not supported by this browser.");
        }
      }

      function selectSeverity(level) {
        selectedSeverityLevel = level;
        document.querySelectorAll(".severity-btn").forEach((btn) => {
          btn.classList.remove("ring-2", "bg-gray-50");
        });
        const btn = document.querySelector(
          `.severity-btn[data-val="${level}"]`
        );
        btn.classList.add("ring-2");
      }

      // VERIFICATION TABS LOGIC
      function setVerificationMode(mode) {
        currentVerificationMode = mode;

        // Reset Tab Styles
        ["photo", "sensor", "sms"].forEach((m) => {
          const btn = document.getElementById(`tab-${m}`);
          const content = document.getElementById(`content-${m}`);

          // Style Reset
          btn.classList.remove(
            "bg-gray-100",
            "text-blue-700",
            "ring-2",
            "ring-blue-700"
          );
          btn.classList.add("bg-white", "text-gray-900");

          // Content visibility
          if (m === mode) {
            content.classList.remove("hidden");
            content.classList.add("block");
            btn.classList.add(
              "bg-gray-100",
              "text-blue-700",
              "ring-2",
              "ring-blue-700"
            );
            btn.classList.remove("bg-white", "text-gray-900");
          } else {
            content.classList.add("hidden");
            content.classList.remove("block");
          }
        });
      }

      function handleFile(input) {
        if (input.files.length > 0) {
          document.getElementById("file-name").classList.remove("hidden");
        }
      }

      function runSensorCheck() {
        const btn = document.getElementById("sensor-btn");
        btn.innerHTML =
          '<i class="fa-solid fa-spinner animate-spin"></i> Analyzing...';

        // Simulation
        setTimeout(() => {
          btn.innerHTML =
            '<i class="fa-solid fa-fingerprint"></i> Check Complete';
          btn.classList.add(
            "bg-green-50",
            "text-green-700",
            "border-green-200"
          );
          document.getElementById("sensor-result").classList.remove("hidden");
          sensorVerified = true;
        }, 1500);
      }

      function cancelReport() {
        document.getElementById("user-form").classList.add("hidden");
        document.getElementById("user-home").classList.remove("hidden");
      }

      function submitReport() {
        if (!selectedSeverityLevel) {
          alert("Please select a water level severity.");
          return;
        }

        let urgency = "Low";
        if (selectedSeverityLevel === "high") urgency = "Critical";
        else if (selectedSeverityLevel === "med") urgency = "Moderate";

        const newReport = {
          id: Date.now(),
          timestamp: new Date().toLocaleTimeString(),
          lat: appState.currentUserLat || 14.5995,
          lng: appState.currentUserLng || 120.9842,
          accuracy: appState.currentUserAccuracy || 15,
          severity: selectedSeverityLevel,
          urgency: urgency,
          people: document.getElementById("people-count").value,
          status: "PENDING",
          verificationType: currentVerificationMode, // Store the method
          hasPhoto: document.getElementById("file-input").files.length > 0,
          sensorVerified: sensorVerified,
        };

        appState.reports.push(newReport);

        document.getElementById("user-form").classList.add("hidden");
        document.getElementById("user-status").classList.remove("hidden");

        startUserStatusListener(newReport.id);
      }

      // --- ADMIN FLOW ---

      function renderAdminFeed() {
        const container = document.getElementById("admin-feed");
        container.innerHTML = "";

        const sortedReports = [...appState.reports].sort((a, b) => {
          const priority = { Critical: 3, Moderate: 2, Low: 1 };
          return priority[b.urgency] - priority[a.urgency];
        });

        if (sortedReports.length === 0) {
          container.innerHTML =
            '<p class="text-center text-gray-400 text-sm mt-10">No active reports.</p>';
          return;
        }

        sortedReports.forEach((report) => {
          const isLocationVerified = report.accuracy <= 20;
          const locationBadge = isLocationVerified
            ? `<span class="text-[10px] bg-green-100 text-green-700 px-1 rounded border border-green-200"><i class="fa-solid fa-crosshairs"></i> GPS Verified</span>`
            : `<span class="text-[10px] bg-yellow-100 text-yellow-700 px-1 rounded border border-yellow-200"><i class="fa-solid fa-circle-question"></i> Low Accuracy</span>`;

          const severityColors = {
            high: "border-l-4 border-l-red-500",
            med: "border-l-4 border-l-orange-400",
            low: "border-l-4 border-l-yellow-400",
          };

          const mapsLink = `https://www.google.com/maps/dir/?api=1&destination=${report.lat},${report.lng}`;

          let actionButton = "";
          if (report.status === "PENDING") {
            actionButton = `<button onclick="updateStatus(${report.id}, 'DISPATCHED')" class="bg-blue-600 text-white text-xs font-bold py-2 px-3 rounded hover:bg-blue-700 w-full mt-2">DISPATCH TEAM</button>`;
          } else if (report.status === "DISPATCHED") {
            actionButton = `<button class="bg-green-600 text-white text-xs font-bold py-2 px-3 rounded cursor-default w-full mt-2"><i class="fa-solid fa-check"></i> TEAM ACTIVE</button>`;
          }

          // Determine Validation Icon/Text
          let validationDisplay = "";
          if (report.verificationType === "photo") {
            validationDisplay = report.hasPhoto
              ? '<p class="text-xs text-blue-600 mb-2"><i class="fa-solid fa-image"></i> Photo Evidence Attached</p>'
              : '<p class="text-xs text-red-500 mb-2"><i class="fa-solid fa-triangle-exclamation"></i> No Photo Uploaded</p>';
          } else if (report.verificationType === "sensor") {
            validationDisplay = report.sensorVerified
              ? '<p class="text-xs text-purple-600 mb-2"><i class="fa-solid fa-fingerprint"></i> Sensor Biometrics Verified</p>'
              : '<p class="text-xs text-gray-400 mb-2"><i class="fa-solid fa-ban"></i> Sensor Check Skipped</p>';
          } else if (report.verificationType === "sms") {
            validationDisplay =
              '<p class="text-xs text-orange-600 mb-2"><i class="fa-solid fa-comment-sms"></i> SMS Callback Requested</p>';
          }

          const card = `
                    <div class="bg-white p-4 rounded-lg shadow-sm border ${
                      severityColors[report.severity]
                    }">
                        <div class="flex justify-between items-start mb-2">
                            <div>
                                <h3 class="font-bold text-gray-800">#${report.id
                                  .toString()
                                  .slice(
                                    -4
                                  )} <span class="text-xs font-normal text-gray-500">(${
            report.timestamp
          })</span></h3>
                                <div class="flex gap-1 mt-1">
                                    <span class="text-[10px] uppercase bg-slate-100 px-1 rounded font-bold tracking-wider">${
                                      report.urgency
                                    }</span>
                                    ${locationBadge}
                                </div>
                            </div>
                            <div class="text-right">
                                <a href="${mapsLink}" target="_blank" class="text-blue-500 text-xs hover:underline"><i class="fa-solid fa-map-location-dot"></i> View Route</a>
                            </div>
                        </div>
                        
                        <div class="text-sm text-gray-600 mb-3 grid grid-cols-2 gap-2">
                            <div class="bg-gray-50 p-2 rounded">
                                <p class="text-xs text-gray-400">Water</p>
                                <p class="font-bold capitalize">${
                                  report.severity === "high"
                                    ? "Roof Level"
                                    : report.severity
                                }</p>
                            </div>
                             <div class="bg-gray-50 p-2 rounded">
                                <p class="text-xs text-gray-400">People</p>
                                <p class="font-bold">${report.people}</p>
                            </div>
                        </div>

                        ${validationDisplay}
                        
                        ${actionButton}
                    </div>
                `;
          container.innerHTML += card;
        });
      }

      function updateStatus(id, newStatus) {
        const report = appState.reports.find((r) => r.id === id);
        if (report) {
          report.status = newStatus;
          renderAdminFeed();
          alert(`Unit dispatched to Incident #${id}`);
        }
      }

      function startUserStatusListener(reportId) {
        const interval = setInterval(() => {
          const report = appState.reports.find((r) => r.id === reportId);

          if (report && report.status === "DISPATCHED") {
            document
              .getElementById("status-icon-container")
              .classList.remove("bg-yellow-100");
            document
              .getElementById("status-icon-container")
              .classList.add("bg-green-100");

            document.getElementById("status-icon").className =
              "fa-solid fa-life-ring text-green-600 text-4xl";
            document.getElementById("status-title").innerText =
              "Help is on the Way!";
            document.getElementById("status-desc").innerText =
              "A response team has been dispatched to your location.";

            document
              .getElementById("step-verified")
              .classList.remove("opacity-40");
            document
              .getElementById("step-dispatched")
              .classList.remove("opacity-40");
            document
              .getElementById("step-dispatched")
              .querySelector(".bg-gray-300")
              .classList.add("bg-green-500", "text-white");
            document
              .getElementById("step-dispatched")
              .querySelector(".bg-gray-300")
              .classList.remove("bg-gray-300");

            document.getElementById("arrival-msg").classList.remove("hidden");

            clearInterval(interval);
          }
        }, 1000);
      }
    </script>
  </body>
</html>
